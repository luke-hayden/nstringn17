theme(axis.text.x = element_text(angle = 60, hjust =1, size=7))+
xlab("Marker") +
ylab("Expression level (Normalised to mean)") +
scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
theme_bw() +
geom_boxplot(outlier.shape=NA)+
scale_y_continuous(trans='log2', breaks=c(0,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2) +
scale_fill_manual(values=c("white", "dark grey"))  +
scale_color_manual(values=c("cornflower blue", "forest green",  "red3")) +
theme(axis.text.x = element_text(angle = 60, hjust =0.5, size=7)) +
facet_wrap(~dir, ncol=1, scales="free_x")
ggplot(manf, aes(x=value, fill=type)) +
theme_bw() +
geom_density(alpha=0.5)  +
scale_fill_manual(values=c("cornflower blue",  "forest green","red3" ), name= "Age") +
scale_x_continuous(trans='log2', breaks=c(0,0.25,0.5,1,2,4))+
facet_wrap(~dir, ncol=1  )
an <- ctg1to9
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
#re <- an[,c(37:48,61:69, 79:84)]
re <- re/rowMeans(re)
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
re <- re[, msi$qual=="ok"]
mre <- melt(re)
mre$sample <- substr(mre$Var2,1,1)
mre$type <- substr(mre$Var2,2,length(mre$Var2))
mre$mk <- substr(mre$Var1, 1,2)
mre$dir <- "upregulated with age"
mre$dir[mre$Var1 %in% gm$marker[gm$dir =="downregulated with age"]] <- "downregulated with age"
mre$md <- paste(substr(mre$dir, 1,2), mre$mk)
ggplot(data=mre, aes(colour=type, x=md, y=value, fill=dir)) +
theme_bw() +
geom_boxplot(outlier.shape=NA) +
scale_y_continuous(trans='log2', breaks=c(0,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2)+
#  facet_wrap(~sample, ncol=1) +
scale_color_manual(values=c("cornflower blue", "forest green",  "dark blue")) +
theme(axis.text.x = element_text(angle = 60, hjust=1))+
scale_fill_manual(values=c("white", "dark grey"))
ggplot(data=mre, aes(colour=type, x=md, y=value)) +
theme_bw() +
geom_point() +
scale_y_continuous(trans='log2', breaks=c(0,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2)+
theme(axis.text.x = element_text(angle = 60, hjust=1))+
facet_wrap(~sample)+
stat_summary(fun.y=mean, geom="point", size=3, shape=18)+
scale_colour_manual(values=c("cornflower blue" , "forest green", "dark blue"), name="Sample Type", labels=c("Before Amputation", "Regenerated","Unamputated"))+
ylab("Expression level (normalised for sample") +
xlab("Marker") +
ggtitle("Effect per marker, per sample")
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok"]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un"]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok"]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un"]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
View(re)
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un"]
rereg
foldchange(rowMeans(rereg), rowMeans(reun))
rowMeans(rereg)
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
rereg
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok"]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un"]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
rowMeans(reun)
rereg
rowMeans(rereg)
rowMeans(reg)
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[,msi$qual == "ok"]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un"]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un"]
rereg
reg <- re[msi$qual == "ok",]
View(reg)
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg",]
View(rereg)
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg",]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un",]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg",]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un",]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
re <- re[order(re$l2fc),]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg",]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un",]
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg",]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un",]
re <- as.data.frame(re)
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg",]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un",]
re <- as.data.frame(re)
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
View(rereg)
an <-subset(an, rownames(an) %in% gm$marker)
View(an)
re <- an[,c(61:72,85:93, 103:108)]
View(re)
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
View(reg)
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg",]
View(rereg)
View(rereg)
rereg <- re[,substr(colnames(re),2,length((colnames(re)))) == "reg"]
View(rereg)
rereg <- re[,substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[,substr(colnames(re),2,length((colnames(re)))) == "un"]
re <- as.data.frame(re)
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
re <- re[order(re$l2fc),]
re$l2fcord <- seq(1, length(re$Abef))
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok",]
rereg <- re[,substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[,substr(colnames(re),2,length((colnames(re)))) == "un"]
re <- as.data.frame(re)
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
re <- re[order(re$l2fc),]
re$l2fcord <- seq(1, length(re$Abef))
recomp <- cbind(rereg, reun)
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
t.result <- apply(recomp, 1, function (x) t.test(x[1:ncol(rereg)],x[ncol(rereg)+1:ncol(recomp)]))
re$p_value <- unlist(lapply(t.result, function(x) x$p.value))
re$t_stat <- unlist(lapply(t.result, function(x) x$statistic))
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
re$marker <- rownames(re)
re$mean <- rowMeans(reg)
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[,msi$qual == "ok"]
rereg <- re[,substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[,substr(colnames(re),2,length((colnames(re)))) == "un"]
re <- as.data.frame(re)
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
re <- re[order(re$l2fc),]
re$l2fcord <- seq(1, length(re$Abef))
recomp <- cbind(rereg, reun)
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
t.result <- apply(recomp, 1, function (x) t.test(x[1:ncol(rereg)],x[ncol(rereg)+1:ncol(recomp)]))
re$p_value <- unlist(lapply(t.result, function(x) x$p.value))
re$t_stat <- unlist(lapply(t.result, function(x) x$statistic))
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
re$marker <- rownames(re)
re$mean <- rowMeans(reg)
mre <- melt(re, id.vars=c("dir", "marker", "mean", "l2fc", "l2fcord", "p_value", "t_stat"))
mre$sample <- substr(mre$variable, 1,1)
mre$type <- substr(mre$variable, 2, length(mre$variable))
cmre <- data.frame(marker = mre$marker[mre$type == "bef"], sample =mre$sample[mre$type == "bef"], dir = mre$dir[mre$type == "bef"],bef= mre$value[mre$type == "bef"], un = mre$value[mre$type == "un"], reg =mre$value[mre$type == "reg"], mean =mre$mean[mre$type == "reg"], l2fc = mre$l2fc[mre$type == "reg"], l2fcord = mre$l2fcord[mre$type == "reg"], p_value=mre$p_value[mre$type == "reg"], t_stat=mre$t_stat[mre$type == "reg"])
cmren <- data.frame(marker = mre$marker[mre$type == "bef"], sample =mre$sample[mre$type == "bef"], dir = mre$dir[mre$type == "bef"], un =cmre$un/cmre$mean, reg =cmre$reg/cmre$mean, l2fc = mre$l2fc[mre$type == "reg"] , l2fcord = cmre$l2fcord, p_value=mre$p_value[mre$type == "reg"], t_stat=mre$t_stat[mre$type == "reg"])
mcmren <- melt(cmren, id.vars=c("marker", "sample", "dir", "l2fc", "l2fcord", "p_value", "t_stat"))
mcmren$md <- paste(substr(mcmren$dir,1,2), substr(mcmren$marker,1,2))
mcmren$ms <- substr(mcmren$marker,1,2)
mcmren$ms <- factor(mcmren$ms, levels=mcmren$ms[order(mcmren$l2fcord)])
ggplot(mcmren, aes(x=ms, y=value, colour=variable)) +
theme_bw() +
geom_point(size=2.3, shape=95)  +
geom_boxplot(outlier.shape=NA)+
scale_color_manual(values=c( "dark blue", "forest green"), name="Sample Type", labels=c("Unamputated", "Regenerated"))+
geom_hline(yintercept=1, colour = "black", linetype=2)+
theme(axis.text.x = element_text(angle = 60, hjust=1))+
facet_wrap(~dir, scales="free_x", ncol=1) +
scale_y_continuous(trans='log2', breaks=c(0,0.25,0.5,1,2,4))+
ylab("Expression level (normalised for sample") +
xlab("Marker")+
ggtitle("Effect per marker, normalised to mean for experiment, ordered by reg vs un l2fc")
mcmren$ms <- factor(mcmren$ms, levels=mcmren$ms[order(mcmren$p_value)])
ggplot(mcmren, aes(x=ms, y=value, colour=variable)) +
theme_bw() +
geom_point(size=2.3, shape=95)  +
geom_boxplot(outlier.shape=NA)+
scale_color_manual(values=c( "dark blue", "forest green"), name="Sample Type", labels=c("Unamputated", "Regenerated"))+
geom_hline(yintercept=1, colour = "black", linetype=2)+
theme(axis.text.x = element_text(angle = 60, hjust=1))+
facet_wrap(~dir, scales="free_x", ncol=1) +
scale_y_continuous(trans='log2', breaks=c(0,0.25,0.5,1,2,4))+
ylab("Expression level (normalised for sample") +
xlab("Marker")+
ggtitle("Effect per marker, normalised to mean for experiment, ordered by reg vs un l2fc")
t.test(mcmren$value[mcmren$variable== "un"], mcmren$value[mcmren$variable== "reg"])
t.test(mcmren$value[mcmren$variable== "un"&mcmren$dir="downregulated with age"], mcmren$value[mcmren$variable== "reg"&mcmren$dir="downregulated with age"])
t.test(mcmren$value[mcmren$variable== "un"&mcmren$dir=="downregulated with age"], mcmren$value[mcmren$variable== "reg"&mcmren$dir=="downregulated with age"])
c(2,5:6, 13:14)
c(2,5:6, 13:14) +24
#log <- 1:ncol(ctg3to9) %in% c(2,5:6, 13:14)
log <- 1:ncol(ctg1to9) %in% c(26, 29:30, 37:38)
ovr <- as.data.frame(ctg1to9[,log==TRUE])
ovrsi <- sampleinfo[log==TRUE,]
ovr$regmean <- rowMeans(data.frame(ovr$OR1a, ovr$OR2a))
ovr$omean <- rowMeans(data.frame(ovr$O2a, ovr$O1b, ovr$O2b))
ovr <- subset(ovr, rownames(ovr) %in% gm$marker)
ovr$regeff <- ovr$regmean/ovr$omean
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[msi$qual == "ok"]
rereg <- re[substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[substr(colnames(re),2,length((colnames(re)))) == "un"]
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
#log <- 1:ncol(ctg3to9) %in% c(2,5:6, 13:14)
log <- 1:ncol(ctg1to9) %in% c(26, 29:30, 37:38)
ovr <- as.data.frame(ctg1to9[,log==TRUE])
ovrsi <- sampleinfo[log==TRUE,]
ovr$regmean <- rowMeans(data.frame(ovr$OR1a, ovr$OR2a))
ovr$omean <- rowMeans(data.frame(ovr$O2a, ovr$O1b, ovr$O2b))
ovr <- subset(ovr, rownames(ovr) %in% gm$marker)
ovr$regeff <- ovr$regmean/ovr$omean
an <-subset(an, rownames(an) %in% gm$marker)
re <- an[,c(61:72,85:93, 103:108)]
msi <- subset(sampleinfo, sampleinfo$sample %in% colnames(re))
reg <- re[,msi$qual == "ok"]
rereg <- re[,substr(colnames(re),2,length((colnames(re)))) == "reg"]
reun <- re[,substr(colnames(re),2,length((colnames(re)))) == "un"]
re <- as.data.frame(re)
re$l2fc <-  foldchange2logratio(foldchange(rowMeans(rereg), rowMeans(reun)))
re <- re[order(re$l2fc),]
re$l2fcord <- seq(1, length(re$Abef))
recomp <- cbind(rereg, reun)
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
t.result <- apply(recomp, 1, function (x) t.test(x[1:ncol(rereg)],x[ncol(rereg)+1:ncol(recomp)]))
re$p_value <- unlist(lapply(t.result, function(x) x$p.value))
re$t_stat <- unlist(lapply(t.result, function(x) x$statistic))
re$dir <- subset(gm, gm$dir != "housekeeping")$dir
re$marker <- rownames(re)
re$mean <- rowMeans(reg)
re$regpval <- ovr$regeff
mre <- melt(re, id.vars=c("dir", "marker", "mean", "l2fc", "l2fcord", "p_value", "t_stat", "regpval"))
mre$sample <- substr(mre$variable, 1,1)
mre$type <- substr(mre$variable, 2, length(mre$variable))
cmre <- data.frame(marker = mre$marker[mre$type == "bef"], sample =mre$sample[mre$type == "bef"], dir = mre$dir[mre$type == "bef"],bef= mre$value[mre$type == "bef"], un = mre$value[mre$type == "un"], reg =mre$value[mre$type == "reg"], mean =mre$mean[mre$type == "reg"], l2fc = mre$l2fc[mre$type == "reg"], l2fcord = mre$l2fcord[mre$type == "reg"], p_value=mre$p_value[mre$type == "reg"], t_stat=mre$t_stat[mre$type == "reg"], regpval=mre$regpval[mre$type == "reg"])
cmren <- data.frame(marker = mre$marker[mre$type == "bef"], sample =mre$sample[mre$type == "bef"], dir = mre$dir[mre$type == "bef"], un =cmre$un/cmre$mean, reg =cmre$reg/cmre$mean, l2fc = mre$l2fc[mre$type == "reg"] , l2fcord = cmre$l2fcord, p_value=mre$p_value[mre$type == "reg"], t_stat=mre$t_stat[mre$type == "reg"], regpval=mre$regpval[mre$type == "reg"])
mcmren <- melt(cmren, id.vars=c("marker", "sample", "dir", "l2fc", "l2fcord", "p_value", "t_stat", "regpval"))
mcmren$md <- paste(substr(mcmren$dir,1,2), substr(mcmren$marker,1,2))
mcmren$ms <- substr(mcmren$marker,1,2)
mcmren$ms <- factor(mcmren$ms, levels=mcmren$ms[order(mcmren$regpval)])
ggplot(mcmren, aes(x=ms, y=value, colour=variable)) +
theme_bw() +
geom_point(size=3, shape=95)  +
stat_summary()+
scale_color_manual(values=c( "dark blue", "forest green"), name="Sample Type", labels=c("Unamputated", "Regenerated"))+
geom_hline(yintercept=1, colour = "black", linetype=2)+
theme(axis.text.x = element_text(angle = 60, hjust=1))+
facet_wrap(~dir, scales="free_x", ncol=1) +
scale_y_continuous(trans='log2', breaks=c(0,0.125,0.25,0.5,1,2,4,8))+
ylab("Expression level (normalised for sample") +
xlab("Marker")+
ggtitle("Effect per marker, normalised to mean for experiment, ordered by reg vs un l2fc") +
geom_point(inherit.aes=FALSE, aes(x=ms, y=regpval), shape=21, fill="chartreuse3")
an <- ctg1to9
an <- subset(an, rownames(an) %in% gm$marker)
log <- sampleinfo$sex =="F" &  sampleinfo$qual == "ok" & sampleinfo$reg != "R"& sampleinfo$age != "N" & sampleinfo$ctg %in% c("3","4","5","6","7","8","9")
anf <- an[,log==TRUE]
anf <- anf/rowMeans(anf)
sif <- subset(sampleinfo, log)
colnames(anf) <- paste( sif$type, colnames(anf))
#anf <- rbind(anf, t(sif))
manf <- melt(anf)
manf$type <- substr(manf$Var2,1,2)
manf$mk <- substr(manf$Var1, 1,2)
manf$dir <- "upregulated with age"
manf$dir[manf$Var1 %in% gm$marker[gm$dir =="downregulated with age"]] <- "downregulated with age"
manf$dm <- paste(substr(manf$dir, 1,1), manf$mk)
ggplot(manf, aes(x=dm, y=value, colour=type)) +
geom_point(shape=95, size=4)  +
theme_bw() +
scale_color_manual(values=c("cornflower blue", "red3"), name= "Age") +
theme(axis.text.x = element_text(angle = 60, hjust =1, size=7))+
xlab("Marker") +
ylab("Expression level (Normalised to mean)") +
scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
geom_boxplot(outlier.alpha = 0)+
theme_bw() +
#  scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2) +
scale_fill_manual(values=c("white", "dark grey"))  +
scale_color_manual(values=c("cornflower blue", "red3")) +
theme(axis.text.x = element_text(angle = 60, hjust =0.5, size=7)) +
facet_wrap(~dir, ncol=1, scales="free_x") +
xlab("Marker") +
ylab("Expression level (Normalised to mean)") +
ylim(c(0,6))
an <- ctg1to9
log <- sampleinfo$sex =="F" &  sampleinfo$qual == "ok" & sampleinfo$reg != "R"& sampleinfo$age != "N"& sampleinfo$ctg %in% c("3","4","5","6","7","8","9")
anf <- an[,log==TRUE]
sif <- subset(sampleinfo, log)
o <- anf[,sif$age == "O" & sif$sex == "F"]
y <- anf[,sif$age == "Y" & sif$sex == "F"]
yo <- as.data.frame(cbind(y,o))
anf <- as.data.frame(anf/rowMeans(anf))
t.result <- apply(yo, 1, function (x) t.test(x[1:ncol(y)],x[ncol(y)+1:ncol(yo)]))
anf$p_value <- unlist(lapply(t.result, function(x) x$p.value))
anf$t_stat <- unlist(lapply(t.result, function(x) x$statistic))
anf$marker <- rownames(anf)
anf$isg <- "not in chosen 61"
anf$isg[anf$marker %in% gm$marker] <- "chosen markers"
#colnames(anf) <- paste( sif$type, colnames(anf))
#anf <- rbind(anf, t(sif))
manf <- melt(anf, id.vars=c("p_value", "marker", "t_stat", "isg"))
manf$type <- "Old"
manf$type[manf$variable %in% sif$sample[sif$age == "Y"]] <- "Young"
manf$mk <- substr(manf$marker, 1,2)
manf$dir <- "upregulated with age"
manf$dir[manf$marker %in% codeset$Customer_Identifier[codeset$log2FoldChange >0]] <- "downregulated with age"
manf$dm <- paste(substr(manf$dir, 1,1), manf$mk)
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
theme_bw() +
geom_boxplot(outlier.alpha = 0)+
scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2) +
scale_fill_manual(values=c("white", "darkgoldenrod1"))  +
scale_color_manual(values=c("cornflower blue", "red3")) +
theme(axis.text.x = element_text(angle = 60, hjust =0.5, size=7)) +
facet_wrap(isg~dir, ncol=1, scales="free_x", strip.position="left") +
xlab("Marker") +
ylab("Expression level (Normalised to mean)")+
ggtitle("Old vs Young in females, both chosen and other markers")
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
geom_boxplot(outlier.alpha = 0)+
scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2) +
scale_fill_manual(values=c("white", "darkgoldenrod1"))  +
scale_color_manual(values=c("cornflower blue", "red3")) +
theme(axis.text.x = element_text(angle = 60, hjust =0.5, size=7)) +
facet_wrap(isg~dir, ncol=1, scales="free_x", strip.position="left") +
xlab("Marker") +
ylab("Expression level (Normalised to mean)")+
ggtitle("Old vs Young in females, both chosen and other markers")
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
theme_fivethirtyeight() +
geom_boxplot(outlier.alpha = 0)+
scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2) +
scale_fill_manual(values=c("white", "darkgoldenrod1"))  +
scale_color_manual(values=c("cornflower blue", "red3")) +
theme(axis.text.x = element_text(angle = 60, hjust =0.5, size=7)) +
facet_wrap(isg~dir, ncol=1, scales="free_x", strip.position="left") +
xlab("Marker") +
ylab("Expression level (Normalised to mean)")+
ggtitle("Old vs Young in females, both chosen and other markers")
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
theme_bw()
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
theme_bw()+
geom_boxplot(outlier.alpha = 0)+
scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2) +
scale_fill_manual(values=c("white", "darkgoldenrod1"))  +
scale_color_manual(values=c("cornflower blue", "red3")) +
theme(axis.text.x = element_text(angle = 60, hjust =0.5, size=7)) +
facet_wrap(isg~dir, ncol=1, scales="free_x", strip.position="left") +
xlab("Marker") +
ylab("Expression level (Normalised to mean)")+
ggtitle("Old vs Young in females, both chosen and other markers")
ggplot(manf, aes(x=mk, y=value, colour=type, fill=dir)) +
theme_bw()+
geom_boxplot(outlier.alpha = 0)+
scale_y_continuous(trans='log2', breaks=c(0,0.062,0.125,0.25,0.5,1,2,4))+
geom_hline(yintercept=1, colour = "black", linetype=2) +
scale_fill_manual(values=c("white", "dark grey"))  +
scale_color_manual(values=c("cornflower blue", "red3")) +
theme(axis.text.x = element_text(angle = 60, hjust =0.5, size=7)) +
facet_wrap(isg~dir, ncol=1, scales="free_x", strip.position="left") +
xlab("Marker") +
ylab("Expression level (Normalised to mean)")+
ggtitle("Old vs Young in females, both chosen and other markers")
log <- sampleinfo$sex =="F" & sampleinfo$ctg %in% c(3,4,5,7) & sampleinfo$qual == "ok" & sampleinfo$reg == "" & sampleinfo$age != "N"
bcmin <- ctg1to9[,c(61:72,85:93, 103:108)]
bcmin.groups <- subset(sampleinfo$type, log==TRUE)
bcmin <- subset(bcmin, rownames(bcmin) %in% gm$marker)
tbc <- t(bcmin)
tbc <- tbc[,colSums(tbc) > 0]
bc.pca <- prcomp(tbc,center = TRUE,scale. = TRUE)
bc.groups <- bcmin.groups
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "red3", "black"))
log <- sampleinfo$sex =="F" & sampleinfo$ctg %in% c(3,4,5,7) & sampleinfo$qual == "ok" & sampleinfo$reg == "" & sampleinfo$age != "N"
bcmin <- ctg1to9[,c(61:72,85:93, 103:108)]
bcmin.groups <- subset(sampleinfo$type, sampleinfo$sample %in% colnames(bcmin))
bcmin <- subset(bcmin, rownames(bcmin) %in% gm$marker)
tbc <- t(bcmin)
tbc <- tbc[,colSums(tbc) > 0]
bc.pca <- prcomp(tbc,center = TRUE,scale. = TRUE)
bc.groups <- bcmin.groups
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "red3", "black"))
View(bcmin)
log <- sampleinfo$sex =="F" & sampleinfo$ctg %in% c(3,4,5,7) & sampleinfo$qual == "ok" & sampleinfo$reg == "" & sampleinfo$age != "N"
bcmin <- ctg1to9[,c(61:72,85:93, 103:108)]
bcmin.groups <- substr(colnames(bcmin),2, length(colnames(bcmin)))
bcmin <- subset(bcmin, rownames(bcmin) %in% gm$marker)
tbc <- t(bcmin)
tbc <- tbc[,colSums(tbc) > 0]
bc.pca <- prcomp(tbc,center = TRUE,scale. = TRUE)
bc.groups <- bcmin.groups
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "red3", "black"))
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "forest green", "dark blue"))
colnames(bcmin)
bcmin[,c(1:5,8:27 ]
bcmin[,c(1:5,8:27) ]
log <- sampleinfo$sex =="F" & sampleinfo$ctg %in% c(3,4,5,7) & sampleinfo$qual == "ok" & sampleinfo$reg == "" & sampleinfo$age != "N"
bcmin <- ctg1to9[,c(61:72,85:93, 103:108)]
bcmin<- bcmin[,c(1:5,8:27) ]
bcmin.groups <- substr(colnames(bcmin),2, length(colnames(bcmin)))
bcmin <- subset(bcmin, rownames(bcmin) %in% gm$marker)
tbc <- t(bcmin)
tbc <- tbc[,colSums(tbc) > 0]
bc.pca <- prcomp(tbc,center = TRUE,scale. = TRUE)
bc.groups <- bcmin.groups
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "forest green", "dark blue"))
log <- sampleinfo$sex =="F" & sampleinfo$ctg %in% c(3,4,5,7) & sampleinfo$qual == "ok" & sampleinfo$reg == "" & sampleinfo$age != "N"
bcmin <- ctg1to9[,c(61:72,85:93, 103:108)]
#bcmin<- bcmin[,c(1:5,8:27) ]
bcmin.groups <- substr(colnames(bcmin),2, length(colnames(bcmin)))
#bcmin <- subset(bcmin, rownames(bcmin) %in% gm$marker)
tbc <- t(bcmin)
tbc <- tbc[,colSums(tbc) > 0]
bc.pca <- prcomp(tbc,center = TRUE,scale. = TRUE)
bc.groups <- bcmin.groups
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "forest green", "dark blue"))
log <- sampleinfo$sex =="F" & sampleinfo$ctg %in% c(3,4,5,7) & sampleinfo$qual == "ok" & sampleinfo$reg == "" & sampleinfo$age != "N"
bcmin <- ctg1to9[,c(61:72,85:93, 103:108)]
bcmin<- bcmin[,c(1:5,8:27) ]
bcmin.groups <- substr(colnames(bcmin),2, length(colnames(bcmin)))
#bcmin <- subset(bcmin, rownames(bcmin) %in% gm$marker)
tbc <- t(bcmin)
tbc <- tbc[,colSums(tbc) > 0]
bc.pca <- prcomp(tbc,center = TRUE,scale. = TRUE)
bc.groups <- bcmin.groups
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "forest green", "dark blue"))
log <- sampleinfo$sex =="F" & sampleinfo$ctg %in% c(3,4,5,7) & sampleinfo$qual == "ok" & sampleinfo$reg == "" & sampleinfo$age != "N"
bcmin <- ctg1to9[,c(61:72,85:93, 103:108)]
bcmin<- bcmin[,c(1:5,8:27) ]
bcmin.groups <- substr(colnames(bcmin),2, length(colnames(bcmin)))
bcmin <- subset(bcmin, rownames(bcmin) %in% gm$marker)
tbc <- t(bcmin)
tbc <- tbc[,colSums(tbc) > 0]
bc.pca <- prcomp(tbc,center = TRUE,scale. = TRUE)
bc.groups <- bcmin.groups
ggbiplot(bc.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = TRUE, var.axes=FALSE, labels=rownames(tbc), groups=bc.groups)+ggtitle("")+
theme_bw() +
scale_colour_manual(values=c("cornflower blue", "forest green", "dark blue"))
