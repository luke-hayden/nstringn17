si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
old <- t(subset(t(md), si$age == "O"))
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- "upregulated with age"
nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot(nmd$p_value, nmd$YvOl2fc)
#ggplot(nmd, aes(x=p_value, y=YvOl2fc))+  geom_point()+  scale_x_log10()
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$sname %in% substr(minf$name[minf$in61],1,2)
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
nmd <- nmd[order(nmd$sname),]
codeset <- codeset[codeset$Customer_Identifier,]
nmd$samedir <- sign(codeset$log2FoldChange) == sign(nmd$YvOl2fc)
mnmd <- melt(nmd, id.vars=c("p_value", "sname","dir", "sp", "sig", "sigstar", "samedir", "YvOl2fc", "ROvOl2fc", "in61", "in61star", "name"))
mnmd$age <- "old"
mnmd$age[mnmd$variable %in% colnames(young)] <- "young"
mnmd$ing <- ""
mnmd$ing[mnmd$variable %in% gm$marker] <- "."
ggplot(mnmd, aes(x= sname, y=value, colour=age)) +
theme_bw()+
geom_point(size=3, shape=95)+
stat_summary()+
scale_y_continuous(trans="log2")+
facet_grid(~dir, space="free",scales="free" )+
#  geom_boxplot(outlier.shape = NA)+
scale_colour_manual(values=c("cornflower blue", "red3"))+
theme(axis.text.x = element_text(angle = 60, hjust = 1, size=4))+
geom_text(colour="black", aes(label=sigstar,y=10))+
geom_text(colour="green", aes(label=ing,y=0.015))+
geom_text(colour="forest green", aes(label=in61star,y=0.1))
sum(nmd$sig)
ggplot(nmd, aes(x=YvOl2fc, y=p_value, colour=in61))+geom_point()
View(nmd)
plot(nmd$p_value, nmd$YvOl2fc)
old <- t(subset(t(md), si$age == "O"))
View(old)
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- "upregulated with age"
nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
View(nmd)
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
View(oy)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot(nmd$p_value, nmd$YvOl2fc)
#ggplot(nmd, aes(x=p_value, y=YvOl2fc))+  geom_point()+  scale_x_log10()
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$sname %in% substr(minf$name[minf$in61],1,2)
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
ggplot(nmd, aes(x=p_value, y=YvOl2fc, colour=in61))  +geom_point()
ggplot(nmd, aes(y=p_value, x=YvOl2fc, colour=in61))  +geom_point()
t.result
mtcars.country <- c(rep("Japan", 3), rep("US",4), rep("Europe", 7),rep("US",3), "Europe", rep("Japan", 3), rep("US",4), rep("Europe", 3), "US", rep("Europe", 3))
ggbiplot(mtcars.pca,ellipse=TRUE,  labels=rownames(mtcars), groups=mtcars.country)
library(ggbiplot)
ggbiplot(mtcars.pca)
mtcars.pca <- prcomp(mtcars[,c(1:7,10,11)], center = TRUE,scale. = TRUE)
summary(mtcars.pca)
str(mtcars.pca)
library(ggbiplot)
ggbiplot(mtcars.pca)
mtcars.pca <- prcomp(mtcars[,c(1:7,10,11)], center = TRUE,scale. = TRUE)
summary(mtcars.pca)
str(mtcars.pca)
library(ggbiplot)
ggbiplot(mtcars.pca)
ggbiplot(mtcars.pca, labels=rownames(mtcars))
mtcars.country <- c(rep("Japan", 3), rep("US",4), rep("Europe", 7),rep("US",3), "Europe", rep("Japan", 3), rep("US",4), rep("Europe", 3), "US", rep("Europe", 3))
ggbiplot(mtcars.pca,ellipse=TRUE,  labels=rownames(mtcars), groups=mtcars.country)
ggbiplot(mtcars.pca,ellipse=TRUE, labels=rownames(mtcars), groups=mtcars.country)
ggbiplot(mtcars.pca,ellipse=TRUE,circle=T, labels=rownames(mtcars), groups=mtcars.country)
ggbiplot(mtcars.pca,ellipse=TRUE,obs.scale = 1, var.scale = 1,  labels=rownames(mtcars), groups=mtcars.country)
ggbiplot(iris.pr, obs.scale = 1, var.scale = 1, ellipse = T, circle = TRUE, var.axes=T, labels=rownames(irismat), groups=iris$Species)
ggbiplot(mtcars.pca,ellipse=TRUE,obs.scale = 1, var.scale = 1,var.axes=FALSE,   labels=rownames(mtcars), groups=mtcars.country)
ggbiplot(mtcars.pca,ellipse=TRUE,obs.scale = 1, var.scale = 1,  labels=rownames(mtcars), groups=mtcars.country) +
scale_colour_manual(name="Origin", values= c("forest green", "red3", "dark blue"))
ggbiplot(mtcars.pca,ellipse=TRUE,obs.scale = 1, var.scale = 1,  labels=rownames(mtcars), groups=mtcars.country) +
scale_colour_manual(name="Origin", values= c("forest green", "red3", "dark blue"))+
ggtitle("PCA of mtcars dataset")+
theme_minimal()
ggbiplot(mtcars.pca,ellipse=TRUE,obs.scale = 1, var.scale = 1,  labels=rownames(mtcars), groups=mtcars.country) +
scale_colour_manual(name="Origin", values= c("forest green", "red3", "dark blue"))+
ggtitle("PCA of mtcars dataset")+
theme_minimal()+
theme(legend.position = "top")
ggbiplot(mtcars.pca,ellipse=TRUE,obs.scale = 1, var.scale = 1,  labels=rownames(mtcars), groups=mtcars.country) +
scale_colour_manual(name="Origin", values= c("forest green", "red3", "dark blue"))+
ggtitle("PCA of mtcars dataset")+
theme_minimal()+
theme(legend.position = "bottom")
ggbiplot(mtcars.pca,ellipse=TRUE,choices=c(1,3),   labels=rownames(mtcars), groups=mtcars.country)
ggbiplot(mtcars.pca,ellipse=TRUE,choices=c(3,4),   labels=rownames(mtcars), groups=mtcars.country)
colnames(mtcars)
spacecar <- c(1000,60,50,500,0,0.5,2.5,0,1,0,0)
mtcarsplus <- rbind(mtcars, spacecar)
mtcarsplus.pca <- prcomp(mtcarsplus[,c(1:7,10,11)], center = TRUE,scale. = TRUE)
ggbiplot(mtcarsplus.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = FALSE, var.axes=TRUE, labels=c(rownames(mtcars), "spacecar"))
colnames(mtcars)
spacecar <- c(1000,60,50,500,0,0.5,2.5,0,1,0,0)
mtcarsplus <- rbind(mtcars, spacecar)
mtcars.countryplus <- c(mtcars.country, "Jupiter")
mtcarsplus.pca <- prcomp(mtcarsplus[,c(1:7,10,11)], center = TRUE,scale. = TRUE)
ggbiplot(mtcarsplus.pca, obs.scale = 1, var.scale = 1, ellipse = TRUE, circle = FALSE, var.axes=TRUE, labels=c(rownames(mtcars), "spacecar"), groups=mtcars.countryplus)+
scale_colour_manual(name="Origin", values= c("forest green", "red3", "violet", "dark blue"))+
ggtitle("PCA of mtcars dataset")+
theme_minimal()+
theme(legend.position = "bottom")
s.sc <- scale(t(spacecar[c(1:7,10,11)]), center= mtcars.pca$center)
s.pred <- s.sc %*% mtcars.pca$rotation
mtcars.plusproj.pca <- mtcars.pca
mtcars.plusproj.pca$x <- rbind(mtcars.plusproj.pca$x, s.pred)
ggbiplot(mtcars.plusproj.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = FALSE, var.axes=TRUE, labels=c(rownames(mtcars), "spacecar"), groups=mtcars.countryplus)
s.sc <- scale(t(spacecar[c(1:7,10,11)]), center= mtcars.pca$center)
s.pred <- s.sc %*% mtcars.pca$rotation
mtcars.plusproj.pca <- mtcars.pca
mtcars.plusproj.pca$x <- rbind(mtcars.plusproj.pca$x, s.pred)
ggbiplot(mtcars.plusproj.pca, obs.scale = 1, var.scale = 1, ellipse = FALSE, circle = FALSE, var.axes=TRUE, labels=c(rownames(mtcars), "spacecar"), groups=mtcars.countryplus)+
scale_colour_manual(name="Origin", values= c("forest green", "red3", "violet", "dark blue"))+
ggtitle("PCA of mtcars dataset, with extra sample projected")+
theme_minimal()+
theme(legend.position = "bottom")
s.sc <- scale(t(spacecar[c(1:7,10,11)]), center= mtcars.pca$center)
s.pred <- s.sc %*% mtcars.pca$rotation
mtcars.plusproj.pca <- mtcars.pca
mtcars.plusproj.pca$x <- rbind(mtcars.plusproj.pca$x, s.pred)
ggbiplot(mtcars.plusproj.pca, obs.scale = 1, var.scale = 1, ellipse = TRUE, circle = FALSE, var.axes=TRUE, labels=c(rownames(mtcars), "spacecar"), groups=mtcars.countryplus)+
scale_colour_manual(name="Origin", values= c("forest green", "red3", "violet", "dark blue"))+
ggtitle("PCA of mtcars dataset, with extra sample projected")+
theme_minimal()+
theme(legend.position = "bottom")
?prcomp
class(mtcars.pca)
mtcars.pca$rotation
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
old <- t(subset(t(md), si$age == "O"))
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- "upregulated with age"
nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
library(ggplot2)
library(rmarkdown)
library(gplots)
library(RColorBrewer)
library(reshape2)
library(scales)
library(ggbiplot)
library(devtools)
library(NanoStringNorm)
library(gtools)
library(Rmisc)
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
old <- t(subset(t(md), si$age == "O"))
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- "upregulated with age"
nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot(nmd$p_value, nmd$YvOl2fc)
#ggplot(nmd, aes(x=p_value, y=YvOl2fc))+  geom_point()+  scale_x_log10()
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$sname %in% substr(minf$name[minf$in61],1,2)
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
ggplot(nmd, aes(y=p_value, x=YvOl2fc, colour=in61))  +geom_point()
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
View(md)
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
View(si)
old <- t(subset(t(md), si$age == "O"))
View(old)
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
View(regen)
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- "upregulated with age"
nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
View(minf)
?arrange
?plyr
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- ifelse(nmd$name %in% minf$name[minf$alldir == "downregulated with age"], "downregulated with age", "upregulated with age")
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot(nmd$p_value, nmd$YvOl2fc)
plot( nmd$YvOl2fc, nmd$p_value)
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$sname %in% substr(minf$name[minf$in61],1,2)
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
ggplot(nmd, aes(y=p_value, x=YvOl2fc, colour=in61))  +geom_point()
sum(nmd$sig)
View(nmd)
nmd$in61 <- nmd$name %in% minf$name[minf$in61]
View(nmd)
nmd <- arrange(nmd, name)
minf <- arrange(minf, name)
nmd$name == minf$name
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
old <- t(subset(t(md), si$age == "O"))
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- arrange(nmd, name)
minf <- arrange(minf, name)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- ifelse(nmd$name %in% minf$name[minf$alldir == "downregulated with age"], "downregulated with age", "upregulated with age")
#nmd$dir <- "upregulated with age"
#nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot( nmd$YvOl2fc, nmd$p_value)
#ggplot(nmd, aes(x=p_value, y=YvOl2fc))+  geom_point()+  scale_x_log10()
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$name %in% minf$name[minf$in61]
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
ggplot(nmd, aes(y=p_value, x=YvOl2fc, colour=in61))  +geom_point()
View(nmd)
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"&  sampleinfo$ctg>2& sampleinfo$type %in% c("O", "Y", "OR") ))
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
nmd <- as.data.frame(md/rowMeans(md))
regonly <- t(subset(t(nmd), si$type == "OR"))
nmd$regstdev <- apply(regonly, 1,sd)
nmd$marker <- rownames(nmd)
nmd <- nmd[order(nmd$marker),]
codeset <- codeset[order(codeset$shortname),]
nmd$dir <- "upregulated with age"
nmd$dir[codeset$log2FoldChange > 0] <- "downregulated with age"
nmd$smarker <- substr(nmd$marker,1,2)
nmd$smarker <- factor(nmd$smarker, levels=nmd$smarker[order(nmd$regstdev)])
nmd <- subset(nmd, nmd$marker %in% nik$fullname[nik$reju =="aged"])
mnmd <- melt(nmd, id.vars=c("marker", "regstdev", "dir", "smarker"))
mnmd$type <- "Y"
mnmd$type[mnmd$variable %in% si$sample[si$type== "OR"]] <- "OR"
mnmd$type[mnmd$variable %in% si$sample[si$type== "O"]] <- "O"
mcodeset <- subset(codeset, codeset$Customer_Identifier %in% nmd$marker)
#print(paste(mcodeset$shortname, ": " ,mcodeset$DrosoTopHit, sep=""))
print(paste(mcodeset$shortname[1:10], ": " ,mcodeset$TopHit[1:10], sep=""))
mnmd$topblast <- ""
for (i in 1:length(codeset$baseMean)){
x = mnmd$marker == codeset$Customer_Identifier[i]
mnmd$topblast[x] <- as.character(codeset$TopHit[i])
mnmd$dtopblast[x] <- as.character(codeset$DrosoTopHit[i])
}
print(paste(mcodeset$shortname, ": " ,mcodeset$TopHit, sep=""))
install.packages("caret")
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
library(ggplot2)
library(rmarkdown)
library(gplots)
library(RColorBrewer)
library(reshape2)
library(scales)
library(ggbiplot)
library(devtools)
library(NanoStringNorm)
library(gtools)
library(Rmisc)
load(file="nov17main_data.rmd")
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
library(ggplot2)
library(rmarkdown)
library(gplots)
library(RColorBrewer)
library(reshape2)
library(scales)
library(ggbiplot)
library(devtools)
library(NanoStringNorm)
library(gtools)
library(Rmisc)
load(file="nov17main_data.rmd")
setwd("~/Documents/nstringnov17")
load(file="nov17main_data.rmd")
setwd("~/Documents/nstringnov17")
load(file="nov17main_data.rmd")
setwd("~/Documents/nstringnov17")
load(file="nov17main_data.rmd")
dir()
load(file="nov17main_data.rmd")
setwd("~/Documents/nstringnov17")
load(file="nov17main_data.rdata")
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
#source("https://bioconductor.org/biocLite.R")
#biocLite("DESeq2")
library(ggplot2)
library(rmarkdown)
library(gplots)
library(RColorBrewer)
library(reshape2)
library(scales)
library(ggbiplot)
library(devtools)
library(NanoStringNorm)
library(gtools)
library(Rmisc)
setwd("~/Documents/nstringnov17")
load(file="nov17main_data.rdata")
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
old <- t(subset(t(md), si$age == "O"))
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- arrange(nmd, name)
minf <- arrange(minf, name)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- ifelse(nmd$name %in% minf$name[minf$alldir == "downregulated with age"], "downregulated with age", "upregulated with age")
#nmd$dir <- "upregulated with age"
#nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot( nmd$YvOl2fc, nmd$p_value)
#ggplot(nmd, aes(x=p_value, y=YvOl2fc))+  geom_point()+  scale_x_log10()
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$name %in% minf$name[minf$in61]
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
ggplot(nmd, aes(y=p_value, x=YvOl2fc, colour=in61))  +geom_point()
nmd <- nmd[order(nmd$sname),]
codeset <- codeset[codeset$Customer_Identifier,]
nmd$samedir <- sign(codeset$log2FoldChange) == sign(nmd$YvOl2fc)
mnmd <- melt(nmd, id.vars=c("p_value", "sname","dir", "sp", "sig", "sigstar", "samedir", "YvOl2fc", "ROvOl2fc", "in61", "in61star", "name"))
mnmd$age <- "old"
mnmd$age[mnmd$variable %in% colnames(young)] <- "young"
mnmd$ing <- ""
mnmd$ing[mnmd$variable %in% gm$marker] <- "."
ggplot(mnmd, aes(x= sname, y=value, colour=age)) +
theme_bw()+
geom_point(size=3, shape=95)+
stat_summary()+
scale_y_continuous(trans="log2")+
facet_grid(~dir, space="free",scales="free" )+
#  geom_boxplot(outlier.shape = NA)+
scale_colour_manual(values=c("cornflower blue", "red3"))+
theme(axis.text.x = element_text(angle = 60, hjust = 1, size=4))+
geom_text(colour="black", aes(label=sigstar,y=10))+
geom_text(colour="green", aes(label=ing,y=0.015))+
geom_text(colour="forest green", aes(label=in61star,y=0.1))
sum(nmd$sig)
ggplot(nmd, aes(x=YvOl2fc, y=p_value, colour=in61))+geom_point()
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
old <- t(subset(t(md), si$age == "O"))
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- arrange(nmd, name)
minf <- arrange(minf, name)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- ifelse(nmd$name %in% minf$name[minf$alldir == "downregulated with age"], "downregulated with age", "upregulated with age")
#nmd$dir <- "upregulated with age"
#nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot( nmd$YvOl2fc, nmd$p_value)
#ggplot(nmd, aes(x=p_value, y=YvOl2fc))+  geom_point()+  scale_x_log10()
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$name %in% minf$name[minf$in61]
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
ggplot(nmd, aes(y=p_value, x=YvOl2fc, colour=in61))  +geom_point()
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
md
View(md)
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
View(si)
old <- t(subset(t(md), si$age == "O"))
View(old)
young <- t(subset(t(md), si$age == "Y"))
View(young)
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
View(regen)
nmd <- as.data.frame(md/rowMeans(md))
View(nmd)
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
View(nmd)
plot( nmd$YvOl2fc, nmd$p_value)
plot( abs(nmd$YvOl2fc), nmd$p_value)
md <- t(subset(t(ctg1to9), sampleinfo$sex == "F"& sampleinfo$qual == "ok"& sampleinfo$ctg %in% c(3,4) & sampleinfo$type %in% c("O", "Y")))
si <- subset(sampleinfo, sampleinfo$sample %in% colnames(md))
old <- t(subset(t(md), si$age == "O"))
young <- t(subset(t(md), si$age == "Y"))
regen <- t(subset(t(ctg1to9), sampleinfo$type == "OR" & sampleinfo$qual == "ok"))
nmd <- as.data.frame(md/rowMeans(md))
nmd$sname <- substr(rownames(md), 1,2)
nmd$name <- rownames(md)
nmd <- arrange(nmd, name)
minf <- arrange(minf, name)
nmd <- nmd[order(nmd$sname),]
nmd$dir <- ifelse(nmd$name %in% minf$name[minf$alldir == "downregulated with age"], "downregulated with age", "upregulated with age")
#nmd$dir <- "upregulated with age"
#nmd$dir[nmd$name %in% minf$name[minf$alldir == "downregulated with age"]] <- "downregulated with age"
nmd$YvOl2fc <- foldchange2logratio(foldchange(rowMeans(young), rowMeans(old)))
nmd$ROvOl2fc <- foldchange2logratio(foldchange(rowMeans(regen), rowMeans(old)))
oy <- cbind(old, young)
t.result <- apply(oy, 1, function (x) t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oy)]))
nmd$p_value <- unlist(lapply(t.result, function(x) x$p.value))
plot( abs(nmd$YvOl2fc), nmd$p_value)
#ggplot(nmd, aes(x=p_value, y=YvOl2fc))+  geom_point()+  scale_x_log10()
nmd$sname <- factor(nmd$sname, levels=nmd$sname[order(nmd$p_value)])
nmd$in61 <- nmd$name %in% minf$name[minf$in61]
nmd$sig <- nmd$p_value <0.05
nmd$sp <- round(nmd$p_value, 2)
nmd$sigstar <- ""
nmd$sigstar[nmd$p_value <0.05] <- "*"
nmd$in61star <- ""
nmd$in61star[nmd$in61 == TRUE] <- "*"
ggplot(nmd, aes(y=p_value, x=YvOl2fc, colour=in61))  +geom_point()
ggplot(nmd, aes(y=p_value, x=abs(YvOl2fc), colour=in61))  +geom_point()
